# Pulse processing program based on the ROOT framework


- Writes a parser to read data that is compatible with Compass raw data output.
- Plots the pulse height distribution, pulse integral distribution and performs pulse shape discrimination (PSD).
- Implements the constant fraction discrimination (CFD) algorithm based on interpolation and plots the time difference histogram and its fit.

## Before runnning

- Make sure you have installed ROOT and your OS is linux. We use ROOT 6.14/04 and Ubuntu 16.04 LTS.
- Download the `input.txt` file and `main` file in `\bin` folder. Put them in the same directory.
- Create a folder named `output` in your current directory.

## Data
- Adjust the parameters in `input.txt`.
    - `Directory`, `Floders` and `Channels` together specify the file path;
    - Use `MaxNumPulses` to specify the numer of pulses you want to process. This can be set small when you want to take a look at the data but don't want to spend too much time on processing.
    - By default the program accepts data generated by CoMPASS, with the following format. You need to change the `NSamples`, `DynamicRange`, `Resolution` and `Delt`according to the digitizer model.
    - ![CoMPASS data format](https://cdn1.imggmi.com/uploads/2019/9/6/d1eb7c2d19b1bbed3dcd1c113215f0d7-full.png)
    - For other data format, adjust the `NHeader`, `HeaderSize` and `Samplesize`. These parameters specify the number of headers and size in byte of each header/sample.

## Pulse integral distribution (PID) plot
- In `input.txt`, make sure `SavePI` is 1 if you want to save the integrals.
    - A file named `PI_CH` should be generated in `output` folder, with a list of pulse integrals recorded. You can use Matlab or other tools to draw a histogram from it, which is the desired pulse integral distribution.
- In `input.txt`, make sure `PID` is 1 if you want to plot the PID in the program.
    - Some options are available, such as integral range (`Pre`, `Post`), plot range (`PImin`, `PImax`) and number of bins.

## Run
- Sometimes the file is too lagre to be processed at one time (a few GB). In this case, you can split the file into several parts and process them seperately. Or you can use a small `MaxNumPulses`.
- Open a terminal, type `./main` to run.
- Use `Ctrl`+ `c` to quit.

## Use
If you use part of this software, please cite the following paper
Fang, M., Bartholomew, N., Di Fulvio, A. Positron annihilation lifetime spectroscopy using fast scintillators and digital electronics
(2019) Nuclear Instruments and Methods in Physics Research, Section A: Accelerators, Spectrometers, Detectors and Associated Equipment, 943, art. no. 162507.